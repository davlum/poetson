{% extends "searchlayout.html" %}

{% block resultbody %}

{% from "includes/_formhelpers.html" import render_field %}
{% from "queryMacros.html" import nom, lugar, fecha, render_profile %}

<div id="tabs" class="container" style="width: 80%;">

    <h2>Bienvenido {{ user.nom_usario }}</h2>
    <br>
    <h3>Tu perfil</h3>
    <p>Algo que explica lo que está pasando</p>
    <br>

    <ul class="nav nav-tabs nav-justified">
        <li class="active"><a data-toggle="tab" href="#inicio">Inicio</a></li>
        <li><a data-toggle="tab" href="#part">Añadir una persona u organización</a></li>
        <li><a data-toggle="tab" href="#pista">Añadir una pista de audio</a></li>
        <li><a data-toggle="tab" href="#contrasena">Cambia la contraseña</a></li>
    </ul>

    <div class="tab-content">

        <div id="inicio" class="tab-pane fade in active">
            <br>
            <h2>Inicio</h2>
            <br>
            <span>Todos los detalles sobre este perfil;
            </span>
            <a class="right underline" href="{{ url_for('user.info') }}">Actualizar información</a>
            <div class="center-block skinny">
                <br>
                <table class="table">
                    <tbody>
                        {% if session['is_person'] %}
                         <tr><th scope="row">Nom: </th><td> {{ nom(user) }}</td></tr>
                            {{ render_profile('Genéro: ', user.genero) }}
                            {{ render_profile('Nombre del Padre: ', user.nom_paterno) }}
                            {{ render_profile('Nombre del Madre: ', user.nom_materno) }}
                        {% else %}
                            {{ render_profile('Nom: ', user.nom_part) }}
                        {% endif %}
                            <tr><th scope="row">Origen: </th><td>{{ lugar(user) }}</td></tr>
                            {{ render_profile('Email: ', user.email) }}
                            {{ render_profile('Sitio Web: ', user.sitio_web) }}
                            {{ render_profile('Telefono: ', user.telefono) }}
                            {{ render_profile('Dirección: ', user.direccion) }}
                            {{ render_profile('Fecha inicial: ', user.fecha_comienzo) }}
                            {{ render_profile('Comentario Adicional: ', user.coment_participante) }}
                    </tbody>
                </table>
                {% if pers_ag.rowcount > 0 %}
                <table class="table">
                    <h3>Parte de</h3>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Título</th>
                            <th>Comienzo</th>
                            <th>Finale</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in pers_ag %}
                            <tr>
                                <td>{{ entry.nom_part }}</td>
                                <td>{{ entry.titulo }}</td>
                                <td>{{ entry.fecha_comienzo }}</td>
                                <td>{{ entry.fecha_finale }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

        <div id="part" class="tab-pane fade">
            <br>
            <h2>Añadido por usted</h2>
            <br>
            <span>Estos son los que ha agregado;</span>
            <a class="right underline" href="{{ url_for('user.poner_part') }}">Nuevo</a>
            <div class="skinny center-block">
            {% if pers is not none and pers is defined %}
                <table class="table">
                    <h3>Persona</h3>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Origen</th>
                            <th>Comienzo</th>
                            <th>Finale</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in pers %}
                            <tr>
                                <td>{{ nom(entry) }}</td>
                                <td>{{ lugar(entry) }}</td>
                                <td>{{ entry.fecha_comienzo }}</td>
                                <td>{{ entry.fecha_finale }}</td>
                                <td>
                                    <a class="glyphicon glyphicon-pencil"
                                       href="{{ url_for('user.poner_pers', part_id=entry.part_id) }}"></a>&nbsp;
                                    <a class="open-confirm-modal glyphicon glyphicon-remove" data-id="{{ entry.part_id }}"
                                        data-toggle="modal" data-target="#confirm-modal"></a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                {% if ags is not none and ags is defined %}
                <table class="table">
                    <h3>Agregar</h3>
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Origen</th>
                            <th>Comienzo</th>
                            <th>Finale</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in ags %}
                            <tr>
                                <td>{{ entry.nom_part }}</td>
                                <td>{{ lugar(entry) }}</td>
                                <td>{{ entry.fecha_comienzo }}</td>
                                <td>{{ entry.fecha_finale }}</td>
                                <td>
                                    <a class="glyphicon glyphicon-pencil"
                                       href="{{ url_for('user.poner_ag', part_id=entry.part_id) }}"></a>&nbsp;
                                    <a class="open-confirm-modal glyphicon glyphicon-remove" data-id="{{ entry.part_id }}"
                                        data-toggle="modal" data-target="#confirm-modal"></a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

        <div id="pista" class="tab-pane fade">
            <br>
            <h2>Añadir una Composición</h2>
            <br>
            <span>Estos son los que ha agregado;</span>
            <a class="right underline" href="{{ url_for('user.poner_comp') }}">Nuevo Composición</a><br>
            <a class="right underline" href="{{ url_for('user.poner_pista') }}">Nuevo Pista</a><br>
            <a class="right underline" href="{{ url_for('user.poner_inst') }}">Nuevo Instrumento</a><br>
            <a class="right underline" href="{{ url_for('user.poner_serie') }}">Nuevo Serie</a>
            <div class="skinny center-block">
                {% if comps is not none and comps is defined %}
                <table class="table">
                    <h3>Composición</h3>
                    <thead>
                        <tr>
                            <th>Título</th>
                            <th>Título Alternativo</th>
                            <th>Fecha publication</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in comps %}
                            <tr>
                                <td>{{ entry.nom_tit }}</td>
                                <td>{{ entry.nom_alt }}</td>
                                <td>{{ entry.fecha_pub }}</td>
                                <td>
                                    <a class="glyphicon glyphicon-pencil"
                                       href="{{ url_for('user.update_comp', comp_id=entry.composicion_id) }}"></a>&nbsp;
                                    <a class="open-confirm-modal glyphicon glyphicon-remove" data-id="{{ entry.composicion_id }}"
                                        data-toggle="modal" data-target="#confirm-modal"></a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                {% if pista is not none and pista is defined %}
                <table class="table">
                    <h3>Pista son</h3>
                    <thead>
                        <tr>
                            <th>Título</th>
                            <th>lugar de interpretación</th>
                            <th>fecha de grabación</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in pista %}
                            <tr>
                                <td>{{ entry.nom_tit }}</td>
                                <td>{{ lugar(entry) }}</td>
                                <td>{{ entry.fecha_grab }}</td>
                                <td>
                                    <a class="glyphicon glyphicon-pencil"
                                       href="{{ url_for('user.update_pista', pista_id=entry.pista_son_id) }}"></a>&nbsp;
                                    <a class="open-confirm-modal glyphicon glyphicon-remove" data-id="{{ entry.pista_son_id }}"
                                        data-toggle="modal" data-target="#confirm-modal"></a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>

        <div id="contrasena" class="tab-pane fade">
            <br>
            <h2>Cambia la contraseña</h2>
            <br>
            <div class="center-block skinny">
                <form class="form-reset" role="form" method="post" action="">
                  {{ password_form.csrf_token }}
                    <div class="row">
                        <div class="form-group col-md-6">
                              {{render_field(password_form.old_password, class ="form-control")}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                              {{render_field(password_form.new_password, class ="form-control")}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                              {{render_field(password_form.confirm, class ="form-control")}}
                        </div>
                    </div>
                    <input type="hidden" style="display: none;" name="password_form">
                  <button class="btn btn-success" type="submit">Actualizar</button>
                </form>
            </div>
        </div>

    </div>

</div>



{% endblock %}